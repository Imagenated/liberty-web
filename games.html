<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Liberty Web – Flappy Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  html, body {
    height: 100%;
    overflow: hidden;
  }

  body {
    margin: 0;
    background: #f3f4f6;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: Arial, Helvetica, sans-serif;
  }

  .home-btn {
    position: fixed;
    top: 20px;
    left: 20px;
    text-decoration: none;
    font-size: 14px;
    padding: 8px 16px;
    border-radius: 20px;
    background: #ffffff;
    border: 1px solid #d1d5db;
    color: #111;
  }

  .home-btn:hover {
    background: #e5e7eb;
  }

  canvas {
    background: #9ee7ff;
    border-radius: 18px;
    box-shadow: 0 20px 40px rgba(0,0,0,0.08);
  }
</style>
</head>

<body>

<a href="tools.html" class="home-btn">← Home</a>

<canvas id="game" width="400" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const sprite = new Image();
sprite.src = "flappy.png";

/* Bird frames (sprite sheet) */
const birdFrames = [
  { x: 3,  y: 491 },
  { x: 37, y: 491 },
  { x: 71, y: 491 }
];

const pipeTop = { x: 112, y: 646, w: 52, h: 320 };
const pipeBottom = { x: 168, y: 646, w: 52, h: 320 };

let birdY = 250;
let velocity = 0;
let gravity = 0.5;
let lift = -8;

let pipes = [];
let frame = 0;
let score = 0;
let birdFrame = 0;
let gameOver = false;

/* Add pipes */
function addPipe() {
  const gap = 130;
  const topHeight = Math.random() * 200 + 50;

  pipes.push({
    x: canvas.width,
    top: topHeight,
    bottom: topHeight + gap,
    passed: false
  });
}

/* Draw bird */
function drawBird() {
  const frameData = birdFrames[birdFrame];
  ctx.drawImage(
    sprite,
    frameData.x, frameData.y, 34, 24,
    68, birdY - 12, 34, 24
  );

  birdFrame = (birdFrame + 1) % birdFrames.length;
}

/* Draw pipes */
function drawPipes() {
  pipes.forEach(pipe => {
    // Top pipe
    ctx.drawImage(
      sprite,
      pipeTop.x, pipeTop.y, pipeTop.w, pipeTop.h,
      pipe.x, pipe.top - pipeTop.h, 52, pipeTop.h
    );

    // Bottom pipe
    ctx.drawImage(
      sprite,
      pipeBottom.x, pipeBottom.y, pipeBottom.w, pipeBottom.h,
      pipe.x, pipe.bottom, 52, pipeBottom.h
    );
  });
}

/* Draw score */
function drawScore() {
  ctx.fillStyle = "#111";
  ctx.font = "22px Arial";
  ctx.fillText("Score: " + score, 20, 35);
}

/* Game loop */
function update() {
  if (gameOver) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  velocity += gravity;
  birdY += velocity;

  if (frame % 90 === 0) addPipe();
  frame++;

  pipes.forEach(pipe => {
    pipe.x -= 2;

    // Collision
    if (
      68 + 17 > pipe.x &&
      68 < pipe.x + 52 &&
      (birdY - 12 < pipe.top || birdY + 12 > pipe.bottom)
    ) {
      gameOver = true;
    }

    // Score
    if (!pipe.passed && pipe.x + 52 < 68) {
      score++;
      pipe.passed = true;
    }
  });

  pipes = pipes.filter(pipe => pipe.x > -60);

  if (birdY < 0 || birdY > canvas.height) {
    gameOver = true;
  }

  drawPipes();
  drawBird();
  drawScore();

  if (gameOver) {
    ctx.fillStyle = "#111";
    ctx.font = "28px Arial";
    ctx.fillText("Game Over", 115, 240);
    ctx.font = "16px Arial";
    ctx.fillText("Refresh to restart", 120, 270);
  }

  requestAnimationFrame(update);
}

/* Controls */
document.addEventListener("keydown", e => {
  if (e.code === "Space") velocity = lift;
});

canvas.addEventListener("click", () => {
  velocity = lift;
});

sprite.onload = update;
</script>

</body>
</html>
